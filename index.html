
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ - í”„ë¦¬ë¯¸ì—„ ë¶„ì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" integrity="sha384-TiCUE00h649CAMonG018J2Ld5i1EDc8C0w4WsyqwiamIDOwrjZxeAChG_Q3eCRg1" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; scroll-behavior: smooth; }
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .gender-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-900 pb-20">

    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-30">
        <div class="max-w-xl mx-auto px-4 h-16 flex items-center justify-between">
            <h1 class="text-xl font-bold flex items-center gap-2"><span class="text-2xl">ğŸ¶</span> AI ë™ë¬¼ìƒ ë¶„ì„ Pro</h1>
            <button id="resetBtn" class="p-2 hover:bg-slate-100 rounded-full transition-colors hidden"><i data-lucide="refresh-cw" class="w-5 h-5 text-slate-500"></i></button>
        </div>
    </header>

    <main class="max-w-xl mx-auto px-4 mt-8">
        <div id="uploadStep" class="space-y-8">
            <div class="text-center space-y-3">
                <h2 class="text-4xl font-extrabold tracking-tight text-slate-900">ë‚´ ì–¼êµ´ì€ ì–´ë–¤ ë™ë¬¼?</h2>
                <p class="text-slate-500 text-lg">AIê°€ ì–¼êµ´í˜•ê³¼ ì´ëª©êµ¬ë¹„ë¥¼ ë¶„ì„í•˜ì—¬<br>ì„±ë³„ì— ë”°ë¥¸ ë§ì¶¤í˜• ë¶„ì„ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
            </div>
            <div class="flex flex-col items-center space-y-4">
                <p class="font-bold text-slate-700">ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                <div class="flex gap-4 w-full max-w-sm">
                    <button id="maleBtn" class="gender-btn active flex-1 py-4 rounded-2xl border-2 border-slate-200 bg-white font-bold transition-all flex items-center justify-center gap-2"><i data-lucide="mars" class="w-5 h-5"></i> ë‚¨ì„±</button>
                    <button id="femaleBtn" class="gender-btn flex-1 py-4 rounded-2xl border-2 border-slate-200 bg-white font-bold transition-all flex items-center justify-center gap-2"><i data-lucide="venus" class="w-5 h-5"></i> ì—¬ì„±</button>
                </div>
            </div>
            <div id="dropZone" class="border-3 border-dashed border-blue-200 rounded-[2.5rem] p-16 bg-white flex flex-col items-center justify-center gap-6 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all group shadow-sm">
                <div class="w-20 h-20 bg-blue-50 rounded-3xl flex items-center justify-center text-blue-500 group-hover:scale-110 group-hover:bg-blue-600 group-hover:text-white transition-all duration-300"><i data-lucide="image-plus" class="w-10 h-10"></i></div>
                <div class="text-center">
                    <p class="font-bold text-xl mb-1">ì‚¬ì§„ ì„ íƒí•˜ê¸°</p>
                    <p class="text-slate-400">ì •ë©´ ì‚¬ì§„ì¼ìˆ˜ë¡ ì •í™•ë„ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤</p>
                </div>
                <input type="file" id="fileInput" class="hidden" accept="image/*">
            </div>
            <div class="flex justify-center gap-4 text-slate-300 font-medium"><span>#ê°•ì•„ì§€ìƒ</span> <span>#ê³ ì–‘ì´ìƒ</span> <span>#í† ë¼ìƒ</span> <span>#ê³µë£¡ìƒ</span> <span>#ì—¬ìš°ìƒ</span></div>
        </div>

        <div id="previewStep" class="hidden space-y-6">
            <div class="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-100">
                <div class="relative aspect-[4/5] bg-slate-200">
                    <img id="previewImg" src="" alt="Preview" class="w-full h-full object-cover">
                    <div id="loadingOverlay" class="absolute inset-0 bg-slate-900/70 backdrop-blur-md hidden flex flex-col items-center justify-center text-white px-6 text-center">
                        <div class="spinner mb-6 border-t-blue-400"></div>
                        <p class="text-xl font-bold tracking-widest animate-pulse">FACIAL FEATURE ANALYSIS...</p>
                        <p class="text-sm text-slate-300 mt-2">AI ì„œë²„ê°€ ë‹¹ì‹ ì˜ ê´€ìƒì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>

            <div id="resultSection" class="hidden space-y-6 fade-in">
                <div id="resultMainCard" class="p-8 rounded-[2rem] text-center space-y-4 shadow-xl border-t-8 transition-all duration-500">
                    <div id="mainAnimalEmoji" class="text-7xl mb-2"></div>
                    <h3 class="text-2xl font-bold text-slate-500">ë¶„ì„ ê²°ê³¼</h3>
                    <h2 class="text-5xl font-black text-slate-900" id="mainAnimalName"></h2>
                    <div class="inline-block px-6 py-2 rounded-full bg-blue-600 text-white font-bold text-xl mt-2" id="mainPercent"></div>
                </div>
                <div class="bg-white p-8 rounded-[2rem] shadow-lg border border-slate-100 space-y-6"><h4 class="font-bold text-lg flex items-center gap-2"><i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-500"></i> ë™ë¬¼ìƒ ë¶„í¬ë„</h4><div id="rankingContainer" class="space-y-4"></div></div>
                <div class="bg-white p-8 rounded-[2rem] shadow-lg border border-slate-100 space-y-4">
                    <h4 class="font-bold text-lg flex items-center gap-2"><i data-lucide="sparkles" class="w-5 h-5 text-amber-500"></i> AI ì¢…í•© ë¶„ì„</h4>
                    <p id="apiSummary" class="text-slate-800 leading-relaxed text-lg font-bold bg-slate-50 p-4 rounded-lg"></p>
                    <h4 class="font-bold text-lg flex items-center gap-2 pt-4"><i data-lucide="book-open" class="w-5 h-5 text-purple-500"></i> ê´€ìƒí•™ì  íŠ¹ì§•</h4>
                    <p id="animalDescription" class="text-slate-600 leading-relaxed text-lg font-medium"></p>
                    <div id="keywords" class="flex flex-wrap gap-2 pt-2"></div>
                </div>
                <div class="bg-white p-8 rounded-[2rem] shadow-lg border border-slate-100 space-y-6"><h4 class="font-bold text-lg flex items-center gap-2"><i data-lucide="users" class="w-5 h-5 text-purple-500"></i> ë‹®ì€ ê¼´ ì—°ì˜ˆì¸ (<span id="selectedGenderText"></span>)</h4><div id="celebrityList" class="grid grid-cols-2 gap-3"></div></div>
            </div>

            <div id="errorSection" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-6 rounded-2xl shadow-md my-6">
                <p class="font-bold text-lg">ğŸ˜¥ ë¶„ì„ ì‹¤íŒ¨</p>
                <p id="errorMessage" class="mt-2"></p>
            </div>

            <div id="actionsSection" class="hidden grid-cols-2 gap-4 pt-4">
                <button id="kakaoShareBtn" class="flex flex-col items-center justify-center p-4 bg-[#FEE500] rounded-2xl font-bold text-slate-900 gap-1 shadow-sm hover:brightness-95 transition-all"><i data-lucide="message-circle" class="w-6 h-6"></i><span class="text-sm">ì¹´í†¡ ê³µìœ </span></button>
                <button id="retestBtn" class="flex flex-col items-center justify-center p-4 bg-slate-900 rounded-2xl font-bold text-white gap-1 shadow-lg hover:bg-slate-800 active:scale-95 transition-all"><i data-lucide="refresh-ccw" class="w-6 h-6"></i><span class="text-sm">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</span></button>
            </div>
        </div>
    </main>

    <footer class="mt-20 text-center text-slate-400 text-sm">
        <p>Â© 2026 AI Animal Face Identity Pro</p>
        <p class="mt-1">Google Gemini 1.5 Flash ëª¨ë¸ì´ ì„±ë³„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
    </footer>

    <script>
        let selectedGender = "male";
        const animalData = {
            "ê°•ì•„ì§€ìƒ": { emoji: "ğŸ¶", color: "border-blue-500", description: "ê´€ìƒí•™ì ìœ¼ë¡œ ëˆˆê¼¬ë¦¬ê°€ ì‚´ì§ ë‚´ë ¤ê°€ê³  ëˆˆë§ìš¸ì´ ë§‘ì€ 'ê²¬ìƒ'ì€ ëŒ€ì¸ê´€ê³„ê°€ ì›ë§Œí•˜ë©° íƒ€ì¸ì—ê²Œ ì‹ ë¢°ë¥¼ ì£¼ëŠ” ìƒì…ë‹ˆë‹¤. ë¶€ë“œëŸ¬ìš´ í„±ì„ ê³¼ ì…ìˆ  ëª¨ì–‘ì€ ì˜¨í™”í•œ ì„±í’ˆì„ ë‚˜íƒ€ë‚´ë©°, ëˆ„êµ¬ì—ê²Œë‚˜ ì‚¬ë‘ë°›ëŠ” 'ì²«ì‚¬ë‘ ì¡°ì‘' ë§¤ë ¥ì„ ì§€ë‹ˆê³  ìˆìŠµë‹ˆë‹¤.", keywords: ["#ì‹ ë¢°ê°", "#ì˜¨í™”í•¨", "#ëŒ€ì¸ê´€ê³„êµ¿", "#ìˆœë‘¥ìˆœë‘¥"], maleCelebs: ["ë°•ë³´ê²€", "ì†¡ì¤‘ê¸°", "ê°•ë‹¤ë‹ˆì—˜", "ë°±í˜„", "ì •í•´ì¸"], femaleCelebs: ["ìˆ˜ì§€", "ì•„ì´ìœ ", "í•œì§€ë¯¼", "ë°•ë³´ì˜", "ìœ¤ì•„"] },
            "ê³ ì–‘ì´ìƒ": { emoji: "ğŸ±", color: "border-purple-600", description: "ëˆˆê¼¬ë¦¬ê°€ ìœ„ë¡œ í–¥í•˜ê³  ëˆˆë§¤ê°€ ë˜ë ·í•œ 'ë¬˜ìƒ'ì€ ì£¼ê´€ì´ ëšœë ·í•˜ê³  ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚œ ìƒì…ë‹ˆë‹¤. ë‚ ë µí•œ í„±ì„ ê³¼ ì½§ë‚ ì€ ë„ë„í•˜ë©´ì„œë„ ì‹œí¬í•œ ë¶„ìœ„ê¸°ë¥¼ ìì•„ë‚´ë©°, ì‰½ê²Œ ë‹¤ê°€ê°ˆ ìˆ˜ ì—†ëŠ” ì•„ìš°ë¼ ë’¤ì— ìˆ¨ê²¨ì§„ ì¹˜ëª…ì ì¸ ë§¤ë ¥ì´ íŠ¹ì§•ì…ë‹ˆë‹¤.", keywords: ["#ì˜ˆìˆ ê°€ì ", "#ë„ë„í•¨", "#ì‹œí¬ë¯¸", "#ì¹˜ëª…ì "], maleCelebs: ["ì§€ë“œë˜ê³¤", "ì£¼ì§€í›ˆ", "ê°•ë™ì›", "ì´ì¤€ê¸°", "í™©ë¯¼í˜„"], femaleCelebs: ["ì œë‹ˆ", "ì•ˆì†Œí¬", "ë…¸ì œ", "í•œì†Œí¬", "ì¹´ë¦¬ë‚˜"] },
            "í† ë¼ìƒ": { emoji: "ğŸ°", color: "border-pink-500", description: "ë™ê·¸ë€ ëˆˆê³¼ ë„ë“œë¼ì§„ ì•ë‹ˆ, ë°ì€ í”¼ë¶€í†¤ì„ ê°€ì§„ 'í† ë¼ìƒ'ì€ ëª…ë‘í•˜ê³  ì‚¬êµì ì¸ ì„±ê²©ì„ ê°€ì§„ ìƒì…ë‹ˆë‹¤. ë³´ëŠ” ì‚¬ëŒì˜ ê¸°ë¶„ì„ ì¢‹ê²Œ ë§Œë“œëŠ” ì—ë„ˆì§€ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ë³´í˜¸ë³¸ëŠ¥ì„ ìê·¹í•˜ëŠ” ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ê³¼ì¦™ë¯¸ê°€ ê°€ì¥ í° ë§¤ë ¥ í¬ì¸íŠ¸ì…ë‹ˆë‹¤.", keywords: ["#ìƒí¼ë°œë„", "#ë³´í˜¸ë³¸ëŠ¥", "#ëŸ¬ë¸”ë¦¬", "#ì‚¬êµì™•"], maleCelebs: ["ì •êµ­", "ìˆ˜í˜¸", "ë„ì˜(NCT)", "ë°•ì§€í›ˆ"], femaleCelebs: ["ë‚˜ì—°", "ì¥ì›ì˜", "ìœˆí„°", "ì¡°ìœ ë¦¬", "ì‚¬ë‚˜"] },
            "ê³µë£¡ìƒ": { emoji: "ğŸ¦–", color: "border-emerald-600", description: "Tì¡´ì´ ëšœë ·í•˜ê³  í•˜ê´€ì´ ë°œë‹¬í•œ 'ê³µë£¡ìƒ'ì€ ì¶”ì§„ë ¥ì´ ê°•í•˜ê³  ë¦¬ë”ì‹­ì´ ë›°ì–´ë‚œ ìƒì…ë‹ˆë‹¤. ê°œì„± ìˆëŠ” ì´ëª©êµ¬ë¹„ì™€ ê°•ë ¬í•œ ëˆˆë¹›ì€ ë§ˆì´ˆì ì¸ ë§¤ë ¥ê³¼ í•¨ê»˜ ë‚¨ì„±ì ì¸ ì¹´ë¦¬ìŠ¤ë§ˆë¥¼ í’ê¸°ë©°, ì•Œìˆ˜ë¡ ë‹¤ì •í•œ ì¸¤ë°ë ˆì  ë©´ëª¨ë¥¼ ë³´ì…ë‹ˆë‹¤.", keywords: ["#ë¦¬ë”ì‹­", "#ì¹´ë¦¬ìŠ¤ë§ˆ", "#ê°œì„±íŒŒ", "#ì¸¤ë°ë ˆ"], maleCelebs: ["ê³µìœ ", "ê¹€ìš°ë¹ˆ", "í™ì¢…í˜„", "íƒ‘", "ë¥˜ì¤€ì—´"], femaleCelebs: ["ê¹€ë‹¤ë¯¸", "ê¹€ê³ ì€", "ì •í˜¸ì—°", "ìŠ¬ê¸°(ë ˆë“œë²¨ë²³)"] },
            "ì—¬ìš°ìƒ": { emoji: "ğŸ¦Š", color: "border-orange-500", description: "ê°€ë¡œë¡œ ê¸´ ëˆˆë§¤ì™€ ë‚ ë µí•œ ì½§ë“±ì„ ê°€ì§„ 'ì—¬ìš°ìƒ'ì€ ì§€í˜œë¡­ê³  ëˆˆì¹˜ê°€ ë¹ ë¥¸ ì˜ë¦¬í•œ ìƒì…ë‹ˆë‹¤. ë¬˜í•œ ì„¹ì‹œí•¨ê³¼ ì§€ì ì¸ ë¶„ìœ„ê¸°ê°€ ê³µì¡´í•˜ë©°, ì‚¬ëŒì„ ë„ëŠ” ë§¤í˜¹ì ì¸ í˜ì´ ìˆì–´ ì‚¬íšŒì ìœ¼ë¡œë„ ì„±ê³µí•  í™•ë¥ ì´ ë†’ì€ ê´€ìƒì…ë‹ˆë‹¤.", keywords: ["#ì˜ë¦¬í•¨", "#ì§€ì ì„¹ì‹œ", "#ë§¤í˜¹ì ", "#ëˆˆì¹˜ë°±ë‹¨"], maleCelebs: ["ì„œì¸êµ­", "ìœ¡ì„±ì¬", "ì´ë„í˜„", "ê¹€ë„ì˜", "ì—°ì¤€"], femaleCelebs: ["í˜„ì•„", "ì˜ˆì§€(ITZY)", "ì²­í•˜", "ê²½ë¦¬", "ì „ì†Œì—°"] }
        };

        // --- ëª¨ë“  ì´ˆê¸°í™” ë¡œì§ì„ DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì•ˆìœ¼ë¡œ ì´ë™ ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            // 1. ì•„ì´ì½˜ì„ ë¨¼ì € ìƒì„±í•©ë‹ˆë‹¤.
            lucide.createIcons();

            // 2. í•„ìš”í•œ ëª¨ë“  HTML ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const fileInput = document.getElementById('fileInput'), dropZone = document.getElementById('dropZone'), uploadStep = document.getElementById('uploadStep'), previewStep = document.getElementById('previewStep'), previewImg = document.getElementById('previewImg'), loadingOverlay = document.getElementById('loadingOverlay'), resultSection = document.getElementById('resultSection'), errorSection = document.getElementById('errorSection'), errorMessage = document.getElementById('errorMessage'), actionsSection = document.getElementById('actionsSection'), rankingContainer = document.getElementById('rankingContainer'), celebrityList = document.getElementById('celebrityList'), keywordsContainer = document.getElementById('keywords'), resetBtn = document.getElementById('resetBtn'), retestBtn = document.getElementById('retestBtn'), kakaoShareBtn = document.getElementById('kakaoShareBtn'), maleBtn = document.getElementById('maleBtn'), femaleBtn = document.getElementById('femaleBtn');

            // 3. ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.
            maleBtn.onclick = () => { selectedGender = "male"; maleBtn.classList.add('active'); femaleBtn.classList.remove('active'); };
            femaleBtn.onclick = () => { selectedGender = "female"; femaleBtn.classList.add('active'); maleBtn.classList.remove('active'); };
            dropZone.onclick = () => fileInput.click();
            resetBtn.onclick = () => location.reload();
            retestBtn.onclick = () => location.reload();

            fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        previewImg.src = ev.target.result;
                        uploadStep.classList.add('hidden');
                        previewStep.classList.remove('hidden');
                        resetBtn.classList.remove('hidden');
                        analyzeImage(ev.target.result.split(',')[1], file.type);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // 4. ì¹´ì¹´ì˜¤ SDKë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                if (response.ok && config.kakaoKey) {
                    Kakao.init(config.kakaoKey);
                } else {
                    console.error("Failed to initialize Kakao SDK:", config.error || "Key not found");
                }
            } catch (error) {
                console.error("Error fetching app configuration:", error);
            }
        }

        async function analyzeImage(base64Data, mimeType) {
            // ... (ë¶„ì„ ë¡œì§ì€ ë³€ê²½ ì—†ìŒ)
            const loadingOverlay = document.getElementById('loadingOverlay');
            const resultSection = document.getElementById('resultSection');
            const errorSection = document.getElementById('errorSection');
            const actionsSection = document.getElementById('actionsSection');

            loadingOverlay.classList.remove('hidden');
            resultSection.classList.add('hidden');
            errorSection.classList.add('hidden');
            actionsSection.style.display = 'none';
            window.scrollTo(0, 0);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ base64Data, mimeType, selectedGender })
                });
                const analysis = await response.json();
                if (!response.ok) { throw new Error(analysis.error || 'ë¶„ì„ ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
                renderResults(analysis);
            } catch (error) {
                console.error(error);
                displayError(`ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            } finally {
                loadingOverlay.classList.add('hidden');
            }
        }

        function displayError(message) {
            document.getElementById('errorMessage').innerText = message;
            document.getElementById('errorSection').classList.remove('hidden');
            document.getElementById('actionsSection').style.display = 'grid';
            document.getElementById('kakaoShareBtn').style.display = 'none';
        }

        function renderResults(analysis) {
            const sortedTypes = Object.entries(analysis.scores).sort(([, a], [, b]) => b - a);
            const topType = sortedTypes[0][0], topPercent = sortedTypes[0][1], data = animalData[topType];
            
            const resultMainCard = document.getElementById('resultMainCard');
            resultMainCard.className = `p-8 rounded-[2rem] text-center space-y-4 shadow-xl border-t-8 bg-white ${data.color}`;
            document.getElementById('mainAnimalEmoji').innerText = data.emoji;
            document.getElementById('mainAnimalName').innerText = topType;
            document.getElementById('mainPercent').innerText = `${topPercent}%`;
            document.getElementById('apiSummary').innerText = analysis.summary;
            document.getElementById('animalDescription').innerText = data.description;
            document.getElementById('selectedGenderText').innerText = selectedGender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';

            const rankingContainer = document.getElementById('rankingContainer');
            rankingContainer.innerHTML = '';
            sortedTypes.forEach(([name, score]) => {
                const row = document.createElement('div');
                row.className = "space-y-1.5";
                row.innerHTML = `<div class="flex justify-between text-sm font-bold"><span>${animalData[name].emoji} ${name}</span><span class="text-blue-600">${score}%</span></div><div class="w-full bg-slate-100 h-2.5 rounded-full overflow-hidden"><div class="h-full bg-blue-500 rounded-full transition-all duration-1000" style="width: 0%"></div></div>`;
                rankingContainer.appendChild(row);
                setTimeout(() => { row.querySelector('.bg-blue-500').style.width = `${score}%`; }, 100);
            });

            const keywordsContainer = document.getElementById('keywords');
            keywordsContainer.innerHTML = '';
            data.keywords.forEach(kw => { const tag = document.createElement('span'); tag.className = "px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-sm font-semibold"; tag.innerText = kw; keywordsContainer.appendChild(tag); });

            const celebrityList = document.getElementById('celebrityList');
            celebrityList.innerHTML = '';
            const celebs = selectedGender === 'male' ? data.maleCelebs : data.femaleCelebs;
            celebs.forEach(name => { const item = document.createElement('div'); item.className = "bg-slate-50 p-3 rounded-xl text-center font-bold text-slate-700 border border-slate-100 shadow-sm"; item.innerText = name; celebrityList.appendChild(item); });

            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('actionsSection').style.display = 'grid';
            document.getElementById('kakaoShareBtn').style.display = 'flex';
            
            document.getElementById('kakaoShareBtn').onclick = () => {
                if (!Kakao.isInitialized()) { alert("ì¹´ì¹´ì˜¤ SDKê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Cloudflare ë¹„ë°€ê°’ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."); return; }
                Kakao.Share.sendDefault({
                    objectType: 'feed',
                    content: { title: `AI ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${topPercent}% ${topType}!`, description: `ë‚˜ëŠ” ì–´ë–¤ ë™ë¬¼ìƒì¼ê¹Œ? AIê°€ ë¶„ì„í•´ì¤€ ë‚´ ê´€ìƒê³¼ ë‹®ì€ ì—°ì˜ˆì¸ì„ í™•ì¸í•´ë³´ì„¸ìš”!`, imageUrl: document.getElementById('previewImg').src, link: { mobileWebUrl: window.location.href, webUrl: window.location.href } },
                    buttons: [{ title: 'ë‚˜ë„ í…ŒìŠ¤íŠ¸í•˜ê¸°', link: { mobileWebUrl: window.location.href, webUrl: window.location.href } }]
                });
            };
        }
    </script>
</body>
</html>
